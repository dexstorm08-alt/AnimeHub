import{j as e,m as t,A as a}from"./animation-jvELU4qo.js";import{r as i,L as r}from"./react-vendor-DxNDjNG-.js";import{s}from"./ui-components-C5QItHIj.js";import"./services-By9PCRKQ.js";class n{static async getRelatedAnime(e,t){try{let a=s.from("anime_relations").select("*").eq("anime_id",e);t&&t.length>0&&(a=a.in("relation_type",t));const{data:i,error:r}=await a.order("created_at",{ascending:!1});return r?[]:i||[]}catch(a){return[]}}static async getSimilarAnime(e,t=12){try{const{data:a,error:i}=await s.from("anime").select("genres, studios").eq("id",e).single();if(i||!a)return[];const{genres:r,studios:n}=a;let l=s.from("anime").select("*").neq("id",e),c="",o="";r&&r.length>0&&(c=r.map(e=>`genres.cs.{${e}}`).join(",")),n&&n.length>0&&(o=n.map(e=>`studios.cs.{${e}}`).join(",")),c&&o?l=l.or(`${c},${o}`):c?l=l.or(c):o&&(l=l.or(o));const{data:m,error:d}=await l.order("rating",{ascending:!1}).limit(t);return d?[]:m||[]}catch(a){return[]}}static async getAnimeByTitleSimilarity(e,t,a=10){try{const i=e.replace(/\s+(Season|S)\s*\d+/gi,"").replace(/\s+\d{4}/g,"").replace(/\s+(Movie|OVA|ONA|Special)/gi,"").trim().split(" ").filter(e=>e.length>2);if(0===i.length)return[];const r=i.map(e=>`title.ilike.%${e}%`).join(","),n=i.map(e=>`title_japanese.ilike.%${e}%`).join(","),{data:l,error:c}=await s.from("anime").select("*").neq("id",t).or(`${r},${n}`).order("year",{ascending:!0}).limit(a);return c?[]:l||[]}catch(i){return[]}}static async getAnimeCharacters(e){try{const{data:t,error:a}=await s.from("anime_characters").select("*").eq("anime_id",e).order("role",{ascending:!0});return a?[]:t||[]}catch(t){return[]}}static async getAnimeStudios(e){try{const{data:t,error:a}=await s.from("anime_studio_relations").select("\n          role,\n          anime_studios (\n            id,\n            name,\n            name_japanese,\n            logo_url,\n            website,\n            founded_year\n          )\n        ").eq("anime_id",e);return a?[]:t||[]}catch(t){return[]}}static async createAnimeRelation(e,t,a){try{const{error:i}=await s.from("anime_relations").insert({anime_id:e,related_anime_id:t,relation_type:a});return!i}catch(i){return!1}}static async createAnimeCharacter(e){try{const{error:t}=await s.from("anime_characters").insert(e);return!t}catch(t){return!1}}static async getAnimeWithRelations(e){try{const[t,a,i,r,n]=await Promise.all([s.from("anime").select("*").eq("id",e).single(),this.getRelatedAnime(e),this.getSimilarAnime(e,6),this.getAnimeCharacters(e),this.getAnimeStudios(e)]);return{anime:t.data,relatedAnime:a,similarAnime:i,characters:r,studios:n}}catch(t){return null}}static async searchAnimeByCriteria(e){try{let t=s.from("anime").select("*"),a="",i="";e.genres&&e.genres.length>0&&(a=e.genres.map(e=>`genres.cs.{${e}}`).join(",")),e.studios&&e.studios.length>0&&(i=e.studios.map(e=>`studios.cs.{${e}}`).join(",")),a&&i?t=t.or(`${a},${i}`):a?t=t.or(a):i&&(t=t.or(i)),e.year&&(t=t.eq("year",e.year)),e.type&&(t=t.eq("type",e.type)),e.status&&(t=t.eq("status",e.status)),e.minRating&&(t=t.gte("rating",e.minRating));const{data:r,error:n}=await t.order("rating",{ascending:!1}).limit(e.limit||20);return n?[]:r||[]}catch(t){return[]}}}function l({animeId:s,currentTitle:l,currentGenres:c}){const[o,m]=i.useState("similar"),{relatedAnime:d,similarAnime:u,loading:g}=function(e){const[t,a]=i.useState([]),[r,s]=i.useState([]),[l,c]=i.useState([]),[o,m]=i.useState([]),[d,u]=i.useState(!0),[g,p]=i.useState(null),x=async()=>{if(e)try{u(!0),p(null);const[t,i,r,l]=await Promise.all([n.getRelatedAnime(e),n.getSimilarAnime(e,8),n.getAnimeCharacters(e),n.getAnimeStudios(e)]);a(t),s(i),c(r),m(l)}catch(t){p(t instanceof Error?t.message:"Failed to fetch anime relations")}finally{u(!1)}};return i.useEffect(()=>{x()},[e]),{relatedAnime:t,similarAnime:r,characters:l,studios:o,loading:d,error:g,refetch:x}}(s),{anime:p,loading:x}=function(e,t,a=10){const[r,s]=i.useState([]),[l,c]=i.useState(!1),[o,m]=i.useState(null),d=async()=>{if(e&&t)try{c(!0),m(null);const i=await n.getAnimeByTitleSimilarity(e,t,a);s(i)}catch(i){m(i instanceof Error?i.message:"Failed to search anime")}finally{c(!1)}};return i.useEffect(()=>{d()},[e,t,a]),{anime:r,loading:l,error:o,refetch:d}}(l,s,8);if(g||x)return e.jsxs(t.section,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-12",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-teal-800 flex items-center",children:[e.jsx("i",{className:"ri-links-line mr-3 text-purple-500"}),"Related Content"]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[...Array(8)].map((t,a)=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"aspect-[3/4] bg-gray-300 rounded-lg"}),e.jsx("div",{className:"mt-2 h-4 bg-gray-300 rounded"})]},a))})]});if(0===u.length&&0===p.length)return null;const y=(()=>{switch(o){case"sequels":return[...d.filter(e=>"sequel"===e.relation_type).map(e=>e.related_anime).filter(Boolean),...p.filter(e=>e.year>(new Date).getFullYear()-5)].slice(0,8);case"prequels":return[...d.filter(e=>"prequel"===e.relation_type).map(e=>e.related_anime).filter(Boolean),...p.filter(e=>e.year<(new Date).getFullYear()-5)].slice(0,8);case"ovas":return u.filter(e=>["ova","movie","special"].includes(e.type)).slice(0,8);default:return u.slice(0,8)}})();return e.jsxs(t.section,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-12",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-teal-800 flex items-center",children:[e.jsx("i",{className:"ri-links-line mr-3 text-purple-500"}),"Related Content"]})}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:[{key:"similar",label:"Similar",icon:"ri-compass-3-line"},{key:"sequels",label:"Sequels",icon:"ri-arrow-right-line"},{key:"prequels",label:"Prequels",icon:"ri-arrow-left-line"},{key:"ovas",label:"OVAs & Movies",icon:"ri-movie-line"}].map(t=>e.jsxs("button",{onClick:()=>m(t.key),className:"flex items-center px-4 py-2 rounded-full font-medium transition-all duration-300 "+(o===t.key?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[e.jsx("i",{className:`${t.icon} mr-2`}),t.label]},t.key))}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6",children:e.jsx(a,{children:y.map((a,i)=>e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.1*i},className:"group",children:e.jsx(r,{to:`/anime/${a.id}`,children:e.jsxs("div",{className:"relative overflow-hidden rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105",children:[e.jsx("div",{className:"aspect-[3/4] bg-gradient-to-br from-gray-200 to-gray-300",children:a.poster_url?e.jsx("img",{src:a.poster_url,alt:a.title,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",onError:e=>{e.currentTarget.style.display="none"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:e.jsx("i",{className:"ri-image-line text-4xl"})})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[e.jsx("h3",{className:"text-white font-semibold text-sm mb-1 line-clamp-2",children:a.title}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-300",children:[e.jsx("span",{className:"bg-blue-600 px-2 py-1 rounded",children:a.year}),e.jsx("span",{className:"bg-purple-600 px-2 py-1 rounded",children:a.type?.toUpperCase()})]}),a.rating&&e.jsxs("div",{className:"mt-2 flex items-center text-yellow-400",children:[e.jsx("i",{className:"ri-star-fill text-xs mr-1"}),e.jsx("span",{className:"text-xs font-medium",children:a.rating})]})]})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("movie"===a.type?"bg-red-600 text-white":"ova"===a.type?"bg-orange-600 text-white":"special"===a.type?"bg-green-600 text-white":"bg-blue-600 text-white"),children:a.type?.toUpperCase()})}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("completed"===a.status?"bg-green-600 text-white":"ongoing"===a.status?"bg-blue-600 text-white":"bg-yellow-600 text-white"),children:a.status?.charAt(0).toUpperCase()+a.status?.slice(1)})})]})})},a.id))})}),0===y.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-search-line text-6xl text-gray-300 mb-4"}),e.jsxs("p",{className:"text-gray-500 text-lg",children:["No ",o," found"]})]})]})}export{l as default};
//# sourceMappingURL=RelatedAnime-D0Qpc7zB.js.map
