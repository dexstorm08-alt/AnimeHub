import{j as e,A as s,m as t}from"./animation-jvELU4qo.js";import{r as a}from"./react-vendor-DxNDjNG-.js";import{d as i}from"./admin-I3YcsrSP.js";import{I as r,B as l}from"./ui-components-C5QItHIj.js";import"./services-By9PCRKQ.js";function n({isOpen:n,onClose:o,onSuccess:d,animeId:c,animeTitle:m,nextEpisodeNumber:u}){const[x,p]=a.useState({episode_number:u,title:"",description:"",thumbnail_url:"",video_url:"",duration:1440,is_premium:!1,air_date:(new Date).toISOString().split("T")[0]}),[h,b]=a.useState(!1),[g,j]=a.useState(null),v=(e,s)=>{p(t=>({...t,[e]:s})),j(null)};return n?e.jsx(s,{children:e.jsx(t.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:o,children:e.jsx(t.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-teal-800",children:"Add Episode"}),e.jsxs("p",{className:"text-gray-600",children:["for ",m]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{p(e=>({...e,title:`Episode ${e.episode_number}: The Journey Begins`,description:"Tanjiro begins his journey to become a demon slayer and save his sister Nezuko. He meets Giyu Tomioka, a demon slayer who will change his life forever.",thumbnail_url:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=225&fit=crop",video_url:"https://www.youtube.com/watch?v=VQGCKyvzIM4",duration:1440,is_premium:!1,air_date:(new Date).toISOString().split("T")[0]})),j(null)},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors duration-200 text-sm",title:"Fill with demo data for testing",children:[e.jsx("i",{className:"ri-magic-line mr-2"}),"Demo Data"]}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]})]}),g&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-300 text-red-700 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("i",{className:"ri-error-warning-line text-xl mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:g}),g.includes("Database not configured")&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"mb-2",children:"To fix this:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-xs",children:[e.jsxs("li",{children:["Create a Supabase project at ",e.jsx("a",{href:"https://supabase.com/dashboard",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"supabase.com"})]}),e.jsxs("li",{children:["Create a ",e.jsx("code",{className:"bg-red-200 px-1 rounded",children:".env.local"})," file in your project root"]}),e.jsx("li",{children:"Add your Supabase URL and API key"}),e.jsx("li",{children:"Restart the development server"})]}),e.jsxs("p",{className:"mt-2 text-xs",children:["See ",e.jsx("code",{className:"bg-red-200 px-1 rounded",children:"SUPABASE-SETUP-GUIDE.md"})," for detailed instructions."]})]})]})]})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!x.episode_number||x.episode_number<1)j("Episode number is required");else{b(!0),j(null);try{const e=new Promise((e,s)=>setTimeout(()=>s(new Error("Request timeout")),1e4)),s=i.createEpisode({anime_id:c,...x}),t=await Promise.race([s,e]);t?(d(t),o(),p(e=>({...e,episode_number:e.episode_number+1,title:"",description:"",thumbnail_url:"",video_url:"",air_date:(new Date).toISOString().split("T")[0]}))):j("Failed to create episode. Please check your database connection and try again.")}catch(s){s instanceof Error?"Request timeout"===s.message?j("Request timed out. Please check your database connection."):j(s.message):j("Failed to create episode. Please try again.")}finally{b(!1)}}},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Episode Number *"}),e.jsx(r,{type:"number",value:x.episode_number||"",onChange:e=>{const s=""===e.target.value?u:parseInt(e.target.value);v("episode_number",isNaN(s)?u:s)},min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Episode Title"}),e.jsx(r,{type:"text",value:x.title,onChange:e=>v("title",e.target.value),placeholder:`Episode ${x.episode_number}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:x.description,onChange:e=>v("description",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent",rows:3,placeholder:"Episode description..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Thumbnail URL"}),e.jsx(r,{type:"url",value:x.thumbnail_url,onChange:e=>v("thumbnail_url",e.target.value),placeholder:"https://example.com/thumbnail.jpg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Video URL *"}),e.jsx(r,{type:"url",value:x.video_url,onChange:e=>v("video_url",e.target.value),placeholder:"https://example.com/video.mp4",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (MM:SS)"}),e.jsx(r,{type:"text",value:(y=x.duration,`${Math.floor(y/60)}:${(y%60).toString().padStart(2,"0")}`),onChange:e=>{const s=(e=>{const[s,t]=e.split(":").map(Number);return 60*s+(t||0)})(e.target.value);isNaN(s)||v("duration",s)},placeholder:"24:00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Air Date"}),e.jsx(r,{type:"date",value:x.air_date,onChange:e=>v("air_date",e.target.value)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"is_premium",checked:x.is_premium,onChange:e=>v("is_premium",e.target.checked),className:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 rounded focus:ring-teal-500"}),e.jsx("label",{htmlFor:"is_premium",className:"text-sm font-medium text-gray-700",children:"Premium Episode (requires subscription)"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(l,{type:"button",variant:"secondary",onClick:o,disabled:h,children:"Cancel"}),e.jsx(l,{type:"submit",disabled:h,className:"flex items-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-add-line"}),"Create Episode"]})})]})]})]})})})}):null;var y}export{n as default};
//# sourceMappingURL=AddEpisodeModal--8b3T5Z2.js.map
