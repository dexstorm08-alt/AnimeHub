import{j as e,m as t}from"./animation-jvELU4qo.js";import{r as s,f as r,h as i,L as a}from"./react-vendor-DxNDjNG-.js";import{s as l,u as o,N as n,S as c,B as d,a as m}from"./ui-components-C5QItHIj.js";import{S as x}from"./player--jbVDcT9.js";import{V as h}from"./services-By9PCRKQ.js";import{e as p,f as u}from"./useAnime-mVfErxXT.js";import{E as g}from"./index-CX_4khTt.js";import{V as j}from"./ErrorFallbacks-Bn_TxtzP.js";import"./admin-I3YcsrSP.js";function f(){const{animeId:f,episode:b}=r(),[N]=i(),{user:y}=o(),w=parseInt(b||"1"),[v,_]=s.useState([]),[$,E]=s.useState(0),[S,k]=s.useState(0),{getEpisodeSources:A,updateWatchProgress:I,getWatchProgress:q}={getEpisodeSources:s.useCallback(async(e,t)=>{try{const{data:s,error:r}=await l.from("episodes").select("*").eq("anime_id",e).eq("episode_number",t).single();if(r||!s)throw new Error("Episode not found");const i=s.video_url;if(!i)throw new Error("No video URL available for this episode");const a=h.detectVideoSource(i);let o=[];return o="youtube"===a?h.generateYouTubeQualities(i):[{quality:"720p",url:i,provider:"Direct",type:a}],{number:t,sources:o,title:s.title||`Episode ${t}`}}catch(s){throw new Error("Failed to fetch episode sources")}},[]),updateWatchProgress:s.useCallback(async(e,t,s)=>{try{const{data:{user:r}}=await l.auth.getUser(),i=`watch_progress_${e}_${t}`;if(localStorage.setItem(i,s.toString()),!r)return;const{data:a,error:o}=await l.from("episodes").select("id").eq("anime_id",e).eq("episode_number",t).single();if(o||!a)return;const{error:n}=await l.from("user_progress").upsert({user_id:r.id,episode_id:a.id,progress_seconds:s,is_completed:!1,last_watched:(new Date).toISOString()})}catch(r){}},[]),getWatchProgress:s.useCallback(async(e,t)=>{try{const{data:{user:s}}=await l.auth.getUser();if(!s){const s=`watch_progress_${e}_${t}`,r=localStorage.getItem(s);return r?parseInt(r):0}const{data:r,error:i}=await l.from("episodes").select("id").eq("anime_id",e).eq("episode_number",t).single();if(i||!r){const s=`watch_progress_${e}_${t}`,r=localStorage.getItem(s);return r?parseInt(r):0}const{data:a,error:o}=await l.from("user_progress").select("progress_seconds").eq("user_id",s.id).eq("episode_id",r.id).maybeSingle();if(o){const s=`watch_progress_${e}_${t}`,r=localStorage.getItem(s);return r?parseInt(r):0}return a?.progress_seconds||0}catch(s){const r=`watch_progress_${e}_${t}`,i=localStorage.getItem(r);return i?parseInt(i):0}},[])},{anime:C,loading:P}=p(f||"",y?.id),T=s.useMemo(()=>C?.genres||[],[C?.genres?.join(",")]),{anime:V,loading:F}=u(f||"",T,6);s.useEffect(()=>{(async()=>{if(!f||!b)return;const e=N.get("progress");if(e){const t=parseInt(e);if(!isNaN(t)&&t>0)return void k(t)}if("true"===N.get("continue"))try{const e=await q(f,parseInt(b));e>0&&k(e)}catch(t){}else k(0)})()},[f,b,N,q]),s.useEffect(()=>{(async()=>{if(f&&b)try{const e=await A(f,parseInt(b));_(e.sources)}catch(e){}})();const e=setInterval(()=>{$>0&&f&&b&&I(f,parseInt(b),Math.floor($)).catch(console.error)},3e4);return()=>{clearInterval(e)}},[f,b,A,I,$]);const B=s.useMemo(()=>{if(!C)return[];if(C.episodes&&C.episodes.length>0)return C.episodes.map((e,t)=>e&&"object"==typeof e?{number:e.episode_number||e.number||t+1,title:e.title||`Episode ${e.episode_number||e.number||t+1}`}:{number:t+1,title:`Episode ${t+1}`});const e=C.total_episodes||1;return Array.from({length:e},(e,t)=>({number:t+1,title:`Episode ${t+1}`}))},[C]);return P?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-yellow-50 to-pink-50",children:[e.jsx(n,{}),e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"text-center",children:e.jsx(c,{size:"xl",text:"Loading anime..."})})})]}):C?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-yellow-50 to-pink-50",children:[e.jsx(n,{}),e.jsx("main",{className:"w-full px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(t.nav,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs("div",{className:"flex items-center space-x-3 text-sm text-teal-600",children:[e.jsxs(a,{to:"/",className:"hover:text-teal-700 transition-colors duration-200 cursor-pointer",children:[e.jsx("i",{className:"ri-home-line mr-1"}),"Home"]}),e.jsx("i",{className:"ri-arrow-right-s-line text-teal-500"}),e.jsx(a,{to:"/anime",className:"hover:text-teal-700 transition-colors duration-200 cursor-pointer",children:"Anime"}),e.jsx("i",{className:"ri-arrow-right-s-line text-teal-500"}),e.jsx(a,{to:`/anime/${f}`,className:"hover:text-teal-700 transition-colors duration-200 cursor-pointer",children:C.title}),e.jsx("i",{className:"ri-arrow-right-s-line text-teal-500"}),e.jsxs("span",{className:"text-teal-700 font-medium",children:["Episode ",w]})]})}),e.jsx(g,{fallback:e.jsx(j,{title:"Video Player Error",message:"The video player encountered an error. This might be due to network issues or an unsupported video format."}),children:e.jsx(t.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},className:"relative bg-black rounded-2xl overflow-hidden shadow-2xl aspect-video mb-12",children:e.jsx(x,{sources:v,animeId:f,episodeNumber:w,title:`${C.title} - Episode ${w}`,onTimeUpdate:(e,t)=>{E(e)},onPlay:()=>{},onPause:()=>{},onEnded:()=>{},onError:e=>{},autoPlay:!0,startTime:S,className:"w-full h-full"},`${f}-${w}`)},`${f}-${w}`)}),e.jsxs(t.section,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},className:"mb-12",children:[e.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-teal-800 mb-8 flex items-center",children:[e.jsx("i",{className:"ri-play-list-line mr-3 text-green-600"}),"Episodes"]}),e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/50",children:e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-3",children:0===B.length?e.jsx("div",{className:"col-span-full text-center py-8",children:e.jsx("p",{className:"text-teal-600",children:"No episodes available"})}):B.map(t=>t&&"object"==typeof t&&t.number&&t.title?e.jsx(a,{to:`/player/${f}/${t.number}`,className:"block p-3 rounded-lg transition-all duration-200 cursor-pointer text-center "+(t.number===w?"bg-teal-600 text-white shadow-lg transform scale-105":"bg-teal-50 text-teal-800 hover:bg-teal-100 hover:shadow-md border border-teal-200 hover:transform hover:scale-105"),children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center mb-2 "+(t.number===w?"bg-white/20":"bg-teal-100"),children:e.jsx("i",{className:"ri-play-fill text-sm "+(t.number===w?"text-white":"text-teal-600")})}),e.jsx("p",{className:"text-xs font-semibold truncate w-full",children:t.number})]})},t.number):null).filter(Boolean)})})]}),e.jsx(t.section,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},className:"mb-12",children:e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/50",children:e.jsxs("div",{className:"flex items-start space-x-8",children:[e.jsx("img",{src:C.poster_url||`https://readdy.ai/api/search-image?query=Anime%20poster%20${C.title}%2C%20Studio%20Ghibli%20style%2C%20beautiful%20artwork%2C%20detailed%20illustration&width=300&height=450&seq=player-poster&orientation=portrait`,alt:C.title,className:"w-32 h-44 object-cover object-top rounded-xl flex-shrink-0",onError:e=>{e.target.src=`https://readdy.ai/api/search-image?query=Anime%20poster%20${C.title}%2C%20Studio%20Ghibli%20style%2C%20beautiful%20artwork%2C%20detailed%20illustration&width=300&height=450&seq=player-poster-fallback&orientation=portrait`}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-teal-800 mb-4",children:C.title}),e.jsx("div",{className:"flex flex-wrap gap-3 mb-4",children:C.genres?.map(t=>e.jsx("span",{className:"px-3 py-2 bg-pink-200 text-teal-800 text-sm rounded-full font-medium",children:t},t))}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-teal-600 mb-4",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"ri-star-fill text-yellow-500"}),e.jsx("span",{className:"font-semibold",children:C.rating||"N/A"})]}),e.jsx("span",{className:"font-medium",children:C.release_year}),e.jsxs("span",{className:"font-medium",children:[C.total_episodes||C.episodes?.length||0," episodes"]})]}),e.jsx("p",{className:"text-teal-700 leading-relaxed text-lg",children:C.description||`Experience the magical world of ${C.title}, a captivating story that will transport you to enchanting realms filled with wonder and adventure.`})]})]})})}),e.jsxs(t.section,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.7},className:"mb-12",children:[e.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-teal-800 mb-8 flex items-center",children:[e.jsx("i",{className:"ri-heart-line mr-3 text-pink-500"}),"Similar Anime"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6",children:F?Array.from({length:6}).map((t,s)=>e.jsxs("div",{className:"bg-white/80 rounded-xl p-4 animate-pulse border border-white/20",children:[e.jsx("div",{className:"aspect-[3/4] bg-teal-100 rounded-lg mb-3"}),e.jsx("div",{className:"h-4 bg-teal-200 rounded mb-2"}),e.jsx("div",{className:"h-3 bg-teal-200 rounded w-2/3"})]},s)):V.length>0?V.map((s,r)=>{const i={_id:s.id,title:s.title,cover:s.poster_url||"https://readdy.ai/api/search-image?query=Anime%20poster%2C%20default%20anime%20image&width=300&height=400&seq=anime-poster&orientation=portrait",banner:s.banner_url,rating:s.rating||0,year:s.year||(new Date).getFullYear(),totalEpisodes:s.total_episodes||1,currentEpisode:0,genres:s.genres||[],status:"ongoing"===s.status?"Ongoing":"completed"===s.status?"Completed":"upcoming"===s.status?"Upcoming":"Ongoing",description:s.description||"",type:"tv"===s.type?"TV":"movie"===s.type?"Movie":"ova"===s.type?"OVA":"special"===s.type?"Special":"TV",studios:s.studios||[],popularity:0,views:0};return e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*r},children:e.jsx(m,{...i})},s.id)}):e.jsx("div",{className:"col-span-full text-center py-8",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl p-8 border border-white/50",children:[e.jsx("i",{className:"ri-movie-2-line text-4xl text-teal-400 mb-4"}),e.jsx("h4",{className:"text-teal-800 font-semibold mb-2",children:"No Similar Anime Found"}),e.jsx("p",{className:"text-teal-600 text-sm mb-4",children:"We couldn't find anime with similar genres"}),e.jsx(a,{to:"/anime",className:"inline-block px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors cursor-pointer",children:"Browse All Anime"})]})})})]})]})}),e.jsx("footer",{className:"bg-teal-800 text-white py-16 mt-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-4",style:{fontFamily:'"Pacifico", serif'},children:"AnimeStream"}),e.jsx("p",{className:"text-teal-200 leading-relaxed",children:"Your magical gateway to the world of anime. Discover, watch, and fall in love with stories that inspire."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Browse"}),e.jsxs("ul",{className:"space-y-3 text-teal-200",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors duration-200 cursor-pointer",children:"Popular"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors duration-200 cursor-pointer",children:"Trending"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors duration-200 cursor-pointer",children:"New Releases"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors duration-200 cursor-pointer",children:"Top Rated"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Genres"}),e.jsxs("ul",{className:"space-y-3 text-teal-200",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors duration-200 cursor-pointer",children:"Action"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors duration-200 cursor-pointer",children:"Romance"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors duration-200 cursor-pointer",children:"Fantasy"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors duration-200 cursor-pointer",children:"Comedy"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Connect"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("a",{href:"#",className:"text-teal-200 hover:text-white transition-colors duration-200 cursor-pointer",children:e.jsx("i",{className:"ri-twitter-fill text-xl"})}),e.jsx("a",{href:"#",className:"text-teal-200 hover:text-white transition-colors duration-200 cursor-pointer",children:e.jsx("i",{className:"ri-facebook-fill text-xl"})}),e.jsx("a",{href:"#",className:"text-teal-200 hover:text-white transition-colors duration-200 cursor-pointer",children:e.jsx("i",{className:"ri-instagram-fill text-xl"})}),e.jsx("a",{href:"#",className:"text-teal-200 hover:text-white transition-colors duration-200 cursor-pointer",children:e.jsx("i",{className:"ri-discord-fill text-xl"})})]})]})]}),e.jsx("div",{className:"border-t border-teal-700 mt-12 pt-8 text-center text-teal-200",children:e.jsxs("p",{children:["© 2024 AnimeStream. All rights reserved. |",e.jsx("a",{href:"https://readdy.ai/?origin=logo",className:"hover:text-white transition-colors duration-200 ml-1 cursor-pointer",children:"Powered by Readdy"})]})})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-yellow-50 to-pink-50",children:[e.jsx(n,{}),e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-16 max-w-md mx-auto border border-white/50",children:[e.jsx("i",{className:"ri-error-warning-line text-7xl text-teal-300 mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-teal-800 mb-4",children:"Anime not found"}),e.jsx(a,{to:"/anime",children:e.jsx(d,{size:"lg",children:"Browse Anime"})})]})})})]})}export{f as default};
//# sourceMappingURL=page-DuxJullu.js.map
