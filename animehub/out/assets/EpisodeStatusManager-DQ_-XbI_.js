import{j as e}from"./animation-jvELU4qo.js";import{r as t}from"./react-vendor-DxNDjNG-.js";import{s,B as a}from"./ui-components-C5QItHIj.js";import"./services-By9PCRKQ.js";class i{static async hasEpisodes(e){try{const{data:t,error:a}=await s.from("anime").select("total_episodes").eq("id",e).single();if(a)return!1;const{data:i,error:r}=await s.from("episodes").select("id").eq("anime_id",e).limit(1);return!r&&(t?.total_episodes&&t.total_episodes>0||i&&i.length>0)}catch(t){return!1}}static async updateAnimeStatus(e){try{if(await this.hasEpisodes(e)){const{error:t}=await s.from("anime").update({status:"ongoing",updated_at:(new Date).toISOString()}).eq("id",e).eq("status","upcoming");return!t}return!1}catch(t){return!1}}static async batchUpdateAnimeStatuses(e){let t=0,s=0;for(const i of e)try{await this.updateAnimeStatus(i)&&t++}catch(a){s++}return{updated:t,errors:s}}static async getUpcomingAnime(){try{const{data:e,error:t}=await s.from("anime").select("id, title, status, total_episodes").eq("status","upcoming");return t?[]:e||[]}catch(e){return[]}}static async autoUpdateUpcomingAnime(){try{const e=(await this.getUpcomingAnime()).map(e=>e.id);return 0===e.length?{updated:0,errors:0}:await this.batchUpdateAnimeStatuses(e)}catch(e){return{updated:0,errors:1}}}}function r({className:s=""}){const{triggerUpdate:r,isUpdating:n,lastUpdate:d,updateStats:l}=function(){const[e,s]=t.useState(!1),[a,r]=t.useState(null),[n,d]=t.useState(null),l=async()=>{try{s(!0);const e=await i.autoUpdateUpcomingAnime();return d(e),r(new Date),e}catch(e){return{updated:0,errors:1}}finally{s(!1)}};return t.useEffect(()=>{const e=setInterval(l,6e5);return l(),()=>clearInterval(e)},[]),{triggerUpdate:l,isUpdating:e,lastUpdate:a,updateStats:n}}(),[c,o]=t.useState(null);return e.jsxs("div",{className:`bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl p-6 border border-white/50 ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-teal-800 flex items-center",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Episode Status Manager"]}),e.jsx(a,{onClick:async()=>{const e=await r();o(e)},disabled:n,className:"bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50",children:n?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin"}),"Updating..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"ri-refresh-line"}),"Update Now"]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-teal-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-teal-800 mb-2",children:"Auto-Update Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-teal-600",children:"Last Update:"}),e.jsx("div",{className:"font-medium",children:d?d.toLocaleString():"Never"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-teal-600",children:"Status:"}),e.jsx("div",{className:"font-medium text-green-600",children:n?"Updating...":"Active"})]})]})]}),(l||c)&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Update Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Anime Updated:"}),e.jsx("div",{className:"font-medium text-green-600",children:(l||c)?.updated||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Errors:"}),e.jsx("div",{className:"font-medium text-red-600",children:(l||c)?.errors||0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"How it works"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• Automatically checks upcoming anime every 10 minutes"}),e.jsx("li",{children:'• Updates status from "upcoming" to "ongoing" when episodes are available'}),e.jsx("li",{children:'• Changes "Watch Now" button to "Upcoming" when no episodes exist'}),e.jsx("li",{children:"• Real-time status updates on anime detail pages"})]})]})]})]})}export{r as default};
//# sourceMappingURL=EpisodeStatusManager-DQ_-XbI_.js.map
