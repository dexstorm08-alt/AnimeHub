import{j as e,m as r}from"./animation-jvELU4qo.js";import{r as t}from"./react-vendor-DxNDjNG-.js";import{S as l}from"./ui-components-C5QItHIj.js";import{V as a}from"./services-By9PCRKQ.js";function i({sources:i,animeId:s,episodeNumber:n,title:o,onTimeUpdate:c,onPlay:d,onPause:u,onEnded:m,onError:g,autoPlay:b=!1,startTime:y=0,className:x=""}){const[f,p]=t.useState({currentSource:null,currentTime:0,duration:0,isPlaying:!1,isLoading:!0,error:null,volume:1,isMuted:!1,quality:"720p",retryCount:0,isRetrying:!1}),h=t.useRef(null),j=t.useRef(null),w=t.useCallback(()=>{if(0===i.length)return void p(e=>({...e,error:"No video sources available",isLoading:!1}));const e=i.find(e=>"1080p"===e.quality)||i.find(e=>"720p"===e.quality)||i[0];p(r=>({...r,currentSource:e,quality:e.quality,isLoading:!1}))},[i]);t.useEffect(()=>{w()},[w]);const v=t.useCallback(()=>{if(i.length>1){const e=i[1],r=document.createElement("link");r.rel="preload",r.as="video",r.href=e.url,document.head.appendChild(r)}},[i]),N=t.useCallback(()=>{if(h.current){const e=h.current;"webkitAudioDecodedByteCount"in e&&(e.webkitAudioDecodedByteCount=0),e.preload="metadata",navigator.userAgent.includes("Mobile")&&(e.playsInline=!0,e.controls=!0)}},[]),k=t.useCallback((e,r)=>{let t=null,l=0;return(...a)=>{const i=Date.now();i-l>r?(e(...a),l=i):(t&&clearTimeout(t),t=setTimeout(()=>{e(...a),l=Date.now()},r-(i-l)))}},[]),S=t.useCallback(()=>{if(h.current&&i.length>1){const e=h.current,r=e.currentTime;if(e.buffered.length>0){const t=e.buffered.end(e.buffered.length-1)-r;if(t<10&&"480p"!==f.quality){const e=i.find(e=>"480p"===e.quality)||i[i.length-1];e&&p(r=>({...r,currentSource:e,quality:e.quality}))}else if(t>30&&"1080p"!==f.quality){const e=i.find(e=>"1080p"===e.quality)||i[0];e&&p(r=>({...r,currentSource:e,quality:e.quality}))}}}},[i,f.quality]),C=t.useMemo(()=>k(S,2e3),[k,S]),q=t.useCallback(()=>{j.current},[]),L=t.useCallback(()=>{if(h.current){const e=h.current.currentTime,r=h.current.duration;p(t=>({...t,currentTime:e,duration:r})),c?.(e,r)}},[c]),P=t.useCallback(()=>{p(e=>({...e,isPlaying:!0})),d?.()},[d]),T=t.useCallback(()=>{p(e=>({...e,isPlaying:!1})),u?.()},[u]),R=t.useCallback(()=>{p(e=>({...e,isPlaying:!1})),m?.()},[m]),E=t.useCallback(e=>{p(r=>r.retryCount<3?(setTimeout(()=>{p(e=>({...e,isRetrying:!0,error:null,isLoading:!0,retryCount:e.retryCount+1})),h.current&&h.current.load()},2e3),{...r,error:`Retrying... (${r.retryCount+1}/3)`,isLoading:!1,isRetrying:!0}):{...r,error:`Failed after 3 attempts: ${e}`,isLoading:!1,isRetrying:!1}),g?.(e)},[g]),_=t.useCallback(e=>{const r=i.find(r=>r.quality===e);r&&p(t=>({...t,currentSource:r,quality:e,isLoading:!0}))},[i]),V=i.map(e=>e.quality).filter((e,r,t)=>t.indexOf(e)===r),O=t=>e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-900 to-black flex items-center justify-center",children:e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-white max-w-md mx-auto px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-external-link-line text-3xl text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"External Video Source"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"This video is hosted on an external streaming site. Click the button below to watch it in a new tab."}),e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-sm text-gray-300 break-all",children:t.url})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx("i",{className:"ri-external-link-line"}),"Watch on External Site"]}),i.length>1&&e.jsx("button",{onClick:()=>{const e=i.findIndex(e=>e.url===t.url),r=i[e+1]||i[0];p(e=>({...e,currentSource:r,error:null,isLoading:!0}))},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Try Different Source"})]})]})}),z=t.useCallback(()=>{p(e=>({...e,error:null,isLoading:!0,retryCount:0,isRetrying:!1})),h.current&&h.current.load()},[]),D=t.useCallback(()=>{if(i.length>1){const e=i.findIndex(e=>e===f.currentSource),r=i[(e+1)%i.length];p(e=>({...e,currentSource:r,quality:r.quality,error:null,isLoading:!0,retryCount:0,isRetrying:!1}))}},[i,f.currentSource]);if(f.error)return e.jsx("div",{className:`relative bg-black rounded-lg overflow-hidden ${x}`,children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-red-900 to-black flex items-center justify-center",children:e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-white max-w-md mx-auto px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"ri-error-warning-line text-3xl text-red-400"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Playback Error"}),e.jsx("p",{className:"text-gray-400 mb-4",children:f.error}),f.isRetrying&&e.jsx("div",{className:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(l,{size:"sm"}),e.jsx("span",{className:"ml-2 text-blue-200",children:"Retrying..."})]})}),f.error?.includes("CORS")&&e.jsx("div",{className:"bg-yellow-500/20 border border-yellow-500/30 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-yellow-200 text-sm",children:"This video source is blocked by CORS policy. Try using a different video source or contact the site administrator."})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs("button",{onClick:z,disabled:f.isRetrying,className:"px-4 py-2 bg-teal-600 hover:bg-teal-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Try Again"]}),i.length>1&&e.jsxs("button",{onClick:D,disabled:f.isRetrying,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-500 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:[e.jsx("i",{className:"ri-swap-line mr-2"}),"Try Different Source"]})]})]})})});if(f.isLoading||!f.currentSource)return e.jsx("div",{className:`relative bg-black rounded-lg overflow-hidden ${x}`,children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-900 to-black flex items-center justify-center",children:e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-white",children:[e.jsx(l,{size:"xl",text:"Loading Player..."}),e.jsx("p",{className:"text-gray-400 mt-4",children:"Preparing your video experience"})]})})});const I=a.detectVideoSource(f.currentSource.url);return e.jsxs("div",{className:`relative bg-black rounded-lg overflow-hidden ${x}`,children:[V.length>1&&e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsx("div",{className:"bg-black/80 backdrop-blur-sm rounded-lg p-2",children:e.jsx("select",{value:f.quality,onChange:e=>_(e.target.value),className:"bg-transparent text-white text-sm border border-gray-600 rounded px-2 py-1",children:V.map(r=>e.jsx("option",{value:r,className:"bg-gray-800",children:r},r))})})}),"youtube"===I?(r=>{const t=a.getYouTubeEmbedUrl(r.url,{autoplay:b,start:y,quality:r.quality});return e.jsx("iframe",{ref:j,src:t,title:o,className:"w-full h-full",allow:"autoplay; encrypted-media; picture-in-picture; fullscreen",onLoad:q})})(f.currentSource):"iframe"===I?(r=>{if(a.isStreamingSitePage(r.url)&&!r.url.toLowerCase().includes("hianime.do"))return O(r);const t=a.getIframeEmbedUrl(r.url,{autoplay:b,start:y,quality:r.quality});return e.jsx("iframe",{ref:j,src:t,title:o,className:"w-full h-full",allow:"autoplay; encrypted-media; picture-in-picture; fullscreen",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",onLoad:()=>{},onError:()=>E("Failed to load video player")})})(f.currentSource):"hls"===I?(r=>{const t=a.processVideoSource(r,s,n,{autoplay:b,start:y,quality:r.quality});return e.jsxs("video",{ref:h,className:"w-full h-full",controls:!0,autoPlay:b,crossOrigin:"anonymous",onTimeUpdate:L,onPlay:P,onPause:T,onEnded:R,onError:e=>{const r=e.target.error;let t="HLS stream failed to load";if(r)switch(r.code){case 1:t="Video loading aborted";break;case 2:t="Network error - check your connection";break;case 3:t="Video decoding error";break;case 4:t="Video source not supported"}E(t)},onLoadStart:()=>{p(e=>({...e,isLoading:!0})),N()},onLoadedData:()=>{p(e=>({...e,isLoading:!1})),v()},onProgress:()=>C(),onWaiting:()=>{C()},children:[e.jsx("source",{src:t.url,type:"application/x-mpegURL"}),"Your browser does not support HLS streaming."]})})(f.currentSource):(r=>{const t=a.processVideoSource(r,s,n,{autoplay:b,start:y,quality:r.quality});return e.jsx("video",{ref:h,src:t.url,className:"w-full h-full",controls:!0,autoPlay:b,crossOrigin:"anonymous",onTimeUpdate:L,onPlay:P,onPause:T,onEnded:R,onError:e=>{const r=e.target.error;let t="Video playback failed";if(r)switch(r.code){case 1:t="Video loading aborted";break;case 2:t="Network error - check your connection";break;case 3:t="Video decoding error";break;case 4:t="Video source not supported"}E(t)},onLoadStart:()=>p(e=>({...e,isLoading:!0})),onLoadedData:()=>p(e=>({...e,isLoading:!1})),children:"Your browser does not support the video tag."})})(f.currentSource),f.isLoading&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"})})]})}const s=Object.freeze(Object.defineProperty({__proto__:null,default:i},Symbol.toStringTag,{value:"Module"})),n=({src:r,title:t="Video Player",width:l="100%",height:a="500px",allowFullScreen:i=!0,className:s=""})=>{const n=r.includes("9anime.org.lv")||r.includes("hianime.do"),o=r.includes("gogoanime.me.uk")||r.includes("gogoanime"),c=r.includes("megaplay.buzz")||r.includes("megaplay");return e.jsx("div",{className:`iframe-player-container ${s}`,children:!n||o||c?e.jsx("iframe",{src:r,title:t,width:l,height:a,allowFullScreen:i,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",className:"w-full h-full rounded-lg shadow-lg",style:{minHeight:"string"==typeof a?a:`${a}px`,border:"none",borderRadius:"8px"},sandbox:"allow-scripts allow-same-origin allow-presentation allow-forms"}):e.jsx("div",{className:"relative w-full h-full bg-gray-900 rounded-lg overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800",children:e.jsxs("div",{className:"text-center text-white p-6",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🎬"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"9anime Player"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"This episode is hosted on 9anime.org.lv"}),e.jsxs("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("span",{className:"mr-2",children:"▶️"}),"Watch on 9anime"]})]})})})})},o=Object.freeze(Object.defineProperty({__proto__:null,IframePlayer:n,default:n},Symbol.toStringTag,{value:"Module"})),c=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{o as I,i as S,c as Y,s as a};
//# sourceMappingURL=player--jbVDcT9.js.map
