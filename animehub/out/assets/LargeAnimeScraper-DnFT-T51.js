import{j as e}from"./animation-jvELU4qo.js";import{r as s}from"./react-vendor-DxNDjNG-.js";class t{static API_BASE_URL="http://localhost:3001";static async startLargeScrape(e,s,t,r=50){try{const a=await fetch(`${this.API_BASE_URL}/api/start-large-scrape`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({animeId:e,animeTitle:s,totalEpisodes:t,chunkSize:r})});if(!a.ok){const e=await a.json();throw new Error(e.error||`Server error: ${a.status}`)}return await a.json()}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}static async getScrapingProgress(e){try{const s=await fetch(`${this.API_BASE_URL}/api/scraping-progress/${e}`);if(!s.ok){const e=await s.json();throw new Error(e.error||`Server error: ${s.status}`)}return{success:!0,progress:(await s.json()).progress}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}static async scrapeChunk(e,s,t,r,a,n=50){try{const c=await fetch(`${this.API_BASE_URL}/api/scrape-chunk`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({animeId:e,animeTitle:s,chunkNumber:t,progressId:r,totalEpisodes:a,chunkSize:n})});if(!c.ok){const e=await c.json();throw new Error(e.error||`Server error: ${c.status}`)}return await c.json()}catch(c){return{success:!1,message:c instanceof Error?c.message:"Unknown error",results:[],summary:{totalEpisodes:0,successCount:0,errorCount:0,successRate:0}}}}static async scrapeAllChunks(e,s,t,r=50,a,n){try{const i=await this.startLargeScrape(e,s,t,r);if(!i.success)throw new Error(i.error||"Failed to start large scrape");const l=Math.ceil(t/r);let o=0;for(let d=1;d<=l;d++)try{const c=await this.getScrapingProgress(e);c.success&&a&&a(c.progress);const m=await this.scrapeChunk(e,s,d,i.jobId,t,r);o++,n&&n(d,m),d<l&&await new Promise(e=>setTimeout(e,1e4))}catch(c){}return{success:!0,message:`Scraping completed: ${o}/${l} chunks processed`,totalChunks:l,completedChunks:o}}catch(c){return{success:!1,message:"Scraping failed",totalChunks:0,completedChunks:0,error:c instanceof Error?c.message:"Unknown error"}}}static calculateEstimatedTime(e,s=50){const t=Math.ceil(e/s),r=(2*e+10*(t-1))/3600,a=r/24;return{totalChunks:t,estimatedHours:Math.round(10*r)/10,estimatedDays:Math.round(10*a)/10}}}function r({animeId:r,animeTitle:a,totalEpisodes:n,onScrapingComplete:c}){const[i,l]=s.useState(!1),[o,d]=s.useState(null),[m,u]=s.useState(50),[h,x]=s.useState(null),[g,p]=s.useState(null),[j,y]=s.useState([]),b=t.calculateEstimatedTime(n,m);s.useEffect(()=>{f()},[r]);const f=async()=>{try{const e=await t.getScrapingProgress(r);e.success&&e.progress&&(d(e.progress),"in_progress"===e.progress.status&&l(!0))}catch(e){}},N=async()=>{try{l(!0),x(null),p(null),y([]);const e=await t.scrapeAllChunks(r,a,n,m,e=>{d(e)},(e,s)=>{y(e=>[s,...e.slice(0,4)])});e.success?(p(`Scraping completed! ${e.completedChunks}/${e.totalChunks} chunks processed`),c&&c()):x(e.error||"Scraping failed")}catch(e){x(e instanceof Error?e.message:"Unknown error occurred")}finally{l(!1)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"üé¨ Large Anime Scraper"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[n," episodes"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:a}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Episodes:"}),e.jsx("div",{className:"font-semibold",children:n})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Chunk Size:"}),e.jsx("div",{className:"font-semibold",children:m})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Chunks:"}),e.jsx("div",{className:"font-semibold",children:b.totalChunks})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Est. Time:"}),e.jsx("div",{className:"font-semibold",children:b.estimatedDays>1?`${b.estimatedDays} days`:`${b.estimatedHours} hours`})]})]})]}),!i&&!o&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chunk Size (episodes per batch)"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"range",min:"10",max:"100",value:m,onChange:e=>u(parseInt(e.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-semibold text-gray-600 min-w-[3rem]",children:m})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Smaller chunks = more control, larger chunks = faster overall"})]}),o&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[o.completedEpisodes,"/",o.totalEpisodes," episodes"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-2",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:`${o.progressPercentage}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:[o.progressPercentage,"% complete"]}),e.jsxs("span",{children:["ETA: ",o.estimatedTimeRemaining]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-green-600 font-semibold",children:o.completedEpisodes}),e.jsx("div",{className:"text-gray-600",children:"Completed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold",children:o.failedEpisodes}),e.jsx("div",{className:"text-gray-600",children:"Failed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-blue-600 font-semibold",children:[o.currentChunk,"/",o.totalChunks]}),e.jsx("div",{className:"text-gray-600",children:"Chunks"})]})]})]}),j.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Recent Chunk Results"}),e.jsx("div",{className:"space-y-2",children:j.map((s,t)=>e.jsx("div",{className:"bg-gray-50 rounded p-3 text-sm",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:[s.summary.successCount," success, ",s.summary.errorCount," failed"]}),e.jsxs("span",{className:"px-2 py-1 rounded text-xs "+(s.summary.successRate>=80?"bg-green-100 text-green-800":s.summary.successRate>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[s.summary.successRate.toFixed(1),"%"]})]})},t))})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[!i&&!o&&e.jsx("button",{onClick:N,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"üöÄ Start Scraping"}),i&&e.jsx("button",{onClick:async()=>{l(!1),p("Scraping paused")},className:"bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"‚è∏Ô∏è Pause"}),o&&!i&&"completed"!==o.status&&e.jsx("button",{onClick:async()=>{o&&await N()},className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"‚ñ∂Ô∏è Resume"}),(o||j.length>0)&&e.jsx("button",{onClick:async()=>{d(null),y([]),x(null),p(null)},className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"üîÑ Reset"})]}),h&&e.jsx("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-red-600 mr-2",children:"‚ùå"}),e.jsx("div",{className:"text-red-800",children:h})]})}),g&&e.jsx("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-green-600 mr-2",children:"‚úÖ"}),e.jsx("div",{className:"text-green-800",children:g})]})}),e.jsx("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-yellow-600 mr-2 mt-0.5",children:"‚ö†Ô∏è"}),e.jsxs("div",{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"Large scraping warning:"})," This will take a significant amount of time. For One Piece (1146 episodes), expect 6-12 hours depending on chunk size and delays. The process can be paused and resumed. Make sure your server stays running."]})]})})]})}export{r as default};
//# sourceMappingURL=LargeAnimeScraper-DnFT-T51.js.map
