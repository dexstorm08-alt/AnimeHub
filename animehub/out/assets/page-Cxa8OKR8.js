import{j as e,m as t,A as a}from"./animation-jvELU4qo.js";import{r as s,L as i}from"./react-vendor-DxNDjNG-.js";import{U as r,s as l,u as n,N as c,S as o,I as d,B as m,b as x}from"./ui-components-C5QItHIj.js";import{F as h}from"./Footer-BpN244TH.js";import{G as p,U as u}from"./GenrePreferences-B6Uurv7K.js";import{g}from"./utils-BIWf2O9c.js";import"./services-By9PCRKQ.js";class j{static async uploadAvatar(e,t,a){if(!e.type.startsWith("image/"))throw new Error("File must be an image");if(e.size>5242880)throw new Error("File size must be less than 5MB");const s=e.name.split(".").pop(),i=`user-avatars/${t}/avatar-${Date.now()}.${s}`;try{a&&a(50);let r=await l.storage.from("user-avatars").upload(i,e,{cacheControl:"3600",upsert:!0});if(r.error&&r.error.message.includes("row-level security")){const a=`user-avatars/${t}/avatar-${Date.now()}.${s}`;r=await l.storage.from("anime-posters").upload(a,e,{cacheControl:"3600",upsert:!0})}if(r.error)throw new Error(`Failed to upload avatar: ${r.error.message}`);const n=r.data.path.includes("user-avatars")?"user-avatars":"anime-posters",{data:c}=l.storage.from(n).getPublicUrl(r.data.path);return a&&a(100),c.publicUrl}catch(r){throw r}}static async deleteAvatar(e){try{const t=new URL(e),a=t.pathname.split("/").slice(-2).join("/"),s=e.includes("anime-posters")?"anime-posters":"user-avatars",{error:i}=await l.storage.from(s).remove([a])}catch(t){}}static getAvatarUrl(e,t){return e||`https://readdy.ai/api/search-image?query=anime%20character%20avatar%2C%20friendly%20face%2C%20${t||"user"}%2C%20simple%20background%2C%20portrait&width=150&height=150&seq=avatar-${t||"default"}&orientation=squarish`}}function b(){const{user:l,loading:b}=n(),[v,f]=s.useState("overview"),[y,N]=s.useState(!1),[w,S]=s.useState(!1),[k,C]=s.useState(!0),[U,W]=s.useState(""),[$,A]=s.useState(!1),[E,F]=s.useState(!1),[R,_]=s.useState(null),[G,L]=s.useState({watchTime:"0 hours",completedSeries:0,currentlyWatching:0,favoriteGenres:[],totalFavorites:0,totalWatchlist:0,totalReviews:0,totalEpisodesWatched:0}),[P,z]=s.useState([]),[T,q]=s.useState([]),{continueWatching:O,loading:D}=function(e){const[t,a]=s.useState([]),[i,l]=s.useState(!0),[n,c]=s.useState(null);return s.useEffect(()=>{if(!e)return a([]),void l(!1);(async()=>{try{l(!0),c(null);const t=(await r.getContinueWatching(e,10)).map(e=>({id:e.episode?.anime_id||"",title:e.episode?.anime?.title||"",episode:e.episode?.episode_number||1,episodeId:e.episode_id||"",progress:Math.round(e.progress_seconds/(e.episode?.duration||1)*100),progressSeconds:e.progress_seconds||0,duration:e.episode?.duration||0,thumbnail:e.episode?.thumbnail_url,anime:e.episode?.anime}));a(t)}catch(t){c(t instanceof Error?t.message:"Failed to fetch continue watching")}finally{l(!1)}})()},[e]),{continueWatching:t,loading:i,error:n}}(l?.id);s.useEffect(()=>{(async()=>{if(l)try{C(!0);const[e,t]=await Promise.all([r.getUserStats(l.id),u.getUserPreferences(l.id)]);L(a=>({...a,completedSeries:e.completedEpisodes,currentlyWatching:e.totalWatchlist,totalFavorites:e.totalFavorites,totalWatchlist:e.totalWatchlist,totalReviews:e.totalReviews,totalEpisodesWatched:e.totalEpisodesWatched,favoriteGenres:t?.favorite_genres||[],watchTime:a.watchTime}));const a=await r.getRecentActivity(l.id);z(a);const s=await r.getAchievements(l.id);q(s)}catch(e){}finally{C(!1)}else C(!1)})()},[l]);if(!b&&!l)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-yellow-50 to-pink-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-user-line text-6xl text-teal-300 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-teal-800 mb-2",children:"Please Sign In"}),e.jsx("p",{className:"text-teal-600 mb-6",children:"You need to be signed in to view your profile."}),e.jsx(i,{to:"/",className:"px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors duration-200",children:"Go Home"})]})});if(k||b)return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-yellow-50 to-pink-50",children:[e.jsx(c,{}),e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(o,{size:"lg",text:"Loading your profile..."})})]});const I=e=>{switch(e){case"watched":return"ri-play-circle-line";case"completed":return"ri-checkbox-circle-line";case"added":return"ri-add-circle-line";case"rated":return"ri-star-line";default:return"ri-circle-line"}},B=e=>{switch(e){case"watched":return"text-blue-600";case"completed":return"text-green-600";case"added":return"text-purple-600";case"rated":return"text-yellow-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-yellow-50 to-pink-50",children:[e.jsx(c,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(t.section,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},className:"mb-8",children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-green-200 p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:R||j.getAvatarUrl(l?.avatar_url,l?.id),alt:"Profile Avatar",className:"w-24 h-24 rounded-full object-cover object-top border-4 border-teal-200",onError:e=>{e.target.src=j.getAvatarUrl(null,l?.id)}}),e.jsxs("div",{className:"absolute bottom-0 right-0",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];if(t&&l)try{F(!0);const e=URL.createObjectURL(t);_(e);const a=await j.uploadAvatar(t,l.id,e=>{});await r.updateUserProfile(l.id,{avatar_url:a});await x.refreshSession(),URL.revokeObjectURL(e),_(null)}catch(a){R&&(URL.revokeObjectURL(R),_(null))}finally{F(!1),e.target.value=""}},className:"hidden",id:"avatar-upload",disabled:E}),e.jsx("label",{htmlFor:"avatar-upload",className:"w-8 h-8 bg-teal-700 text-white rounded-full flex items-center justify-center hover:bg-teal-600 transition-colors duration-200 cursor-pointer "+(E?"opacity-50 cursor-not-allowed":""),title:"Upload Avatar",children:E?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx("i",{className:"ri-camera-line text-sm"})})]})]}),e.jsxs("div",{className:"flex-1",children:[y?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-teal-700 mb-2",children:"Username"}),e.jsx(d,{value:U,onChange:e=>W(e.target.value),placeholder:"Enter your username"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only username can be changed"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl font-bold text-teal-800 mb-2",children:l?.username||"Anime Fan"}),e.jsx("p",{className:"text-teal-600 mb-4",children:l?.email}),e.jsx("div",{className:"flex items-center gap-2 mb-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium "+("vip"===l?.subscription_type?"bg-purple-200 text-purple-800":"premium"===l?.subscription_type?"bg-yellow-200 text-yellow-800":"bg-green-200 text-green-800"),children:l?.subscription_type?.toUpperCase()||"FREE"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-teal-600 mb-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"ri-calendar-line"}),"Joined ",new Date(l?.created_at||"").toLocaleDateString("en-US",{month:"long",year:"numeric"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"ri-time-line"}),G.watchTime," watched"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"ri-checkbox-circle-line"}),G.completedSeries," completed"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[G.favoriteGenres&&G.favoriteGenres.length>0?G.favoriteGenres.map(t=>e.jsx("span",{className:"px-3 py-1 bg-pink-200 text-teal-800 text-sm rounded-full font-medium",children:t},t)):e.jsx("span",{className:"text-sm text-teal-500 italic",children:"No favorite genres yet"}),e.jsxs("button",{onClick:()=>S(!0),className:"px-3 py-1 bg-teal-100 text-teal-700 text-sm rounded-full font-medium hover:bg-teal-200 transition-colors flex items-center gap-1",children:[e.jsx("i",{className:"ri-add-line text-xs"}),G.favoriteGenres.length>0?"Edit":"Add"," Genres"]})]})]}),e.jsx("div",{className:"flex gap-3",children:y?e.jsxs(e.Fragment,{children:[e.jsx(m,{onClick:async()=>{if(l&&U.trim()&&!$)try{A(!0);await r.updateUserProfile(l.id,{username:U.trim()});await x.refreshSession(),N(!1),W("")}catch(e){}finally{A(!1)}},size:"sm",disabled:!U.trim()||$,children:$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-save-line mr-2"}),"Save Username"]})}),e.jsx(m,{variant:"secondary",onClick:()=>{W(""),N(!1)},size:"sm",disabled:$,children:"Cancel"})]}):e.jsxs(m,{onClick:()=>{W(l?.username||""),N(!0)},variant:"secondary",size:"sm",children:[e.jsx("i",{className:"ri-edit-line mr-2"}),"Edit Username"]})})]})})}),e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"mb-8",children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-green-200 p-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:[{id:"overview",label:"Overview",icon:"ri-dashboard-line"},{id:"watching",label:"Currently Watching",icon:"ri-play-circle-line"},{id:"activity",label:"Recent Activity",icon:"ri-history-line"},{id:"achievements",label:"Achievements",icon:"ri-trophy-line"}].map(t=>e.jsxs("button",{onClick:()=>f(t.id),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 "+(v===t.id?"bg-teal-700 text-white shadow-sm":"text-teal-700 hover:bg-green-100"),children:[e.jsx("i",{className:t.icon}),t.label]},t.id))})})}),e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:["overview"===v&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-green-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-play-circle-line text-2xl text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-teal-800",children:G.currentlyWatching}),e.jsx("p",{className:"text-teal-600",children:"Currently Watching"})]})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-green-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-checkbox-circle-line text-2xl text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-teal-800",children:G.completedSeries}),e.jsx("p",{className:"text-teal-600",children:"Completed Series"})]})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-green-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-time-line text-2xl text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-teal-800",children:G.watchTime}),e.jsx("p",{className:"text-teal-600",children:"Total Watch Time"})]})]})})]}),"watching"===v&&e.jsx("div",{className:"space-y-4",children:D?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-teal-200 border-t-teal-600 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-teal-700 font-medium",children:"Loading your watch progress..."})]}):O.length>0?O.map((a,s)=>e.jsx(t.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.1*s},className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-green-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(i,{to:`/anime/${a.anime?.id}`,className:"flex-shrink-0",children:e.jsx("img",{src:a.thumbnail||a.anime?.poster_url||"https://readdy.ai/api/search-image?query=Anime%20thumbnail%2C%20default%20anime%20image&width=200&height=300&seq=watching-thumbnail&orientation=portrait",alt:a.title,className:"w-16 h-20 object-cover object-top rounded-lg hover:scale-105 transition-transform duration-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{to:`/anime/${a.anime?.id}`,children:e.jsx("h3",{className:"text-lg font-bold text-teal-800 mb-2 hover:text-teal-600 transition-colors duration-200",children:a.title})}),e.jsxs("p",{className:"text-teal-600 text-sm mb-3",children:["Episode ",a.episode]}),e.jsx("div",{className:"w-full bg-green-200 rounded-full h-2 mb-3",children:e.jsx("div",{className:"bg-teal-700 h-2 rounded-full transition-all duration-300",style:{width:`${a.progress}%`}})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{to:g(a.anime?.id||"",a.episode,a.progressSeconds),children:e.jsxs(m,{size:"sm",children:[e.jsx("i",{className:"ri-play-fill mr-1"}),"Continue Watching"]})}),e.jsxs("span",{className:"text-sm text-teal-600",children:[a.progress,"% complete"]})]})]})]})},a.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-play-circle-line text-6xl text-teal-300 mb-4"}),e.jsx("p",{className:"text-teal-600 text-lg",children:"No anime in progress"}),e.jsx("p",{className:"text-teal-500 text-sm",children:"Start watching to see your progress here"})]})}),"activity"===v&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-green-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-teal-800 mb-6",children:"Recent Activity"}),e.jsx("div",{className:"space-y-4",children:P.length>0?P.map((a,s)=>e.jsxs(t.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.1*s},className:"flex items-center gap-4 p-4 hover:bg-green-50 rounded-lg transition-colors duration-200",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${B(a.type)} bg-current bg-opacity-10`,children:e.jsx("i",{className:`${I(a.type)} ${B(a.type)}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-teal-800",children:["watched"===a.type&&`Watched episode ${a.episode} of `,"completed"===a.type&&"Completed ","added"===a.type&&"Added to watchlist ","rated"===a.type&&`Rated ${a.rating}/10 `,e.jsx(i,{to:`/anime/${a.anime.id}`,className:"font-medium hover:text-teal-600 transition-colors duration-200",children:a.anime.title})]}),e.jsx("p",{className:"text-sm text-teal-600",children:a.time})]})]},s)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"ri-history-line text-6xl text-teal-300 mb-4"}),e.jsx("p",{className:"text-teal-600 text-lg",children:"No recent activity"}),e.jsx("p",{className:"text-teal-500 text-sm",children:"Start watching anime to see your activity here"})]})})]}),"achievements"===v&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.length>0?T.map((a,s)=>e.jsx(t.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1*s},className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border p-6 "+(a.earned?"border-yellow-300 bg-yellow-50/50":"border-green-200"),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center "+(a.earned?"bg-yellow-100 text-yellow-600":"bg-gray-100 text-gray-400"),children:e.jsx("i",{className:`${a.icon} text-2xl`})}),e.jsx("h3",{className:"text-lg font-bold mb-2 "+(a.earned?"text-yellow-700":"text-gray-500"),children:a.title}),e.jsx("p",{className:"text-sm "+(a.earned?"text-yellow-600":"text-gray-400"),children:a.description}),a.earned&&e.jsx("div",{className:"mt-3",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 bg-yellow-200 text-yellow-800 text-xs rounded-full",children:[e.jsx("i",{className:"ri-check-line mr-1"}),"Earned"]})})]})},s)):e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("i",{className:"ri-trophy-line text-6xl text-teal-300 mb-4"}),e.jsx("p",{className:"text-teal-600 text-lg",children:"No achievements yet"}),e.jsx("p",{className:"text-teal-500 text-sm",children:"Start watching anime to unlock achievements"})]})})]},v)]}),e.jsx(a,{children:w&&l&&e.jsx(t.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",onClick:()=>S(!1),children:e.jsx(t.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:e.jsx(p,{userId:l.id,onSave:e=>{L(t=>({...t,favoriteGenres:e})),S(!1)},onCancel:()=>{S(!1)}})})})}),e.jsx(h,{})]})}export{b as default};
//# sourceMappingURL=page-Cxa8OKR8.js.map
