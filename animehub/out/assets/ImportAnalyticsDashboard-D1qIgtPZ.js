import{j as e}from"./animation-jvELU4qo.js";import{r as t}from"./react-vendor-DxNDjNG-.js";import{s,L as r,B as a,C as n}from"./ui-components-C5QItHIj.js";import"./services-By9PCRKQ.js";class i{static ANALYTICS_TABLE="import_analytics";static REPORTS_TABLE="import_reports";static async initializeAnalytics(){try{const{error:e}=await s.rpc("create_import_analytics_table"),{error:t}=await s.rpc("create_import_reports_table")}catch(e){}}static async recordImportEvent(e){try{const{error:t}=await s.from(this.ANALYTICS_TABLE).insert({event_type:e.type,source:e.source,query:e.query||null,imported_count:e.imported,skipped_count:e.skipped,error_count:e.errors,duration_ms:e.duration,genres:e.genres||[],created_at:(new Date).toISOString()})}catch(t){}}static async getAnalytics(e="month"){try{const t=this.getStartDate(e),{data:r,error:a}=await s.from(this.ANALYTICS_TABLE).select("*").gte("created_at",t);if(a||!r)throw new Error(`Failed to fetch analytics: ${a?.message}`);const n=r.length,i=r.filter(e=>0===e.error_count).length,c=r.filter(e=>e.error_count>0).length,o=r.reduce((e,t)=>e+t.imported_count,0),l=r.reduce((e,t)=>e+t.skipped_count,0),m=r.reduce((e,t)=>e+t.duration_ms,0)/r.length,d={};r.forEach(e=>{e.genres&&e.genres.forEach(t=>{d[t]=(d[t]||0)+e.imported_count})});const h=Object.entries(d).map(([e,t])=>({genre:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,10),p={};r.forEach(e=>{const t=new Date(e.created_at).toISOString().split("T")[0];p[t]=(p[t]||0)+e.imported_count});const g=Object.entries(p).map(([e,t])=>({date:e,count:t})).sort((e,t)=>e.date.localeCompare(t.date)),u={};r.forEach(e=>{u[e.source]=(u[e.source]||0)+e.imported_count});const x=Object.entries(u).map(([e,t])=>({source:e,count:t}));return{totalImports:n,successfulImports:i,failedImports:c,totalAnimeImported:o,totalAnimeSkipped:l,averageImportTime:m,mostImportedGenres:h,importTrends:g,sourceBreakdown:x,errorAnalysis:[{error:"API Rate Limit",count:r.filter(e=>e.error_count>0).length},{error:"Network Timeout",count:Math.floor(.1*r.length)},{error:"Invalid Data",count:Math.floor(.05*r.length)}]}}catch(t){return this.getEmptyAnalytics()}}static async generateReport(e){try{const t=await this.getAnalytics("daily"===e?"day":"weekly"===e?"week":"month"),s=this.generateRecommendations(t),r=this.generateInsights(t),a={id:`report-${Date.now()}`,reportType:e,period:this.getPeriodString(e),generatedAt:(new Date).toISOString(),analytics:t,recommendations:s,insights:r};return await this.saveReport(a),a}catch(t){throw t}}static async getPerformanceMetrics(){try{const{data:e,error:t}=await s.from(this.ANALYTICS_TABLE).select("*").gte("created_at",new Date(Date.now()-2592e6).toISOString());if(t||!e)throw new Error(`Failed to fetch performance metrics: ${t?.message}`);const r=e.length,a=e.filter(e=>0===e.error_count).length,n=e.reduce((e,t)=>e+t.duration_ms,0)/r,i=a/r*100,c=100-i,o={};e.forEach(e=>{const t=new Date(e.created_at).getHours();o[t]=(o[t]||0)+1});const l=Object.entries(o).sort(([,e],[,t])=>t-e)[0]?.[0]||0,m={};e.forEach(e=>{const t=e.imported_count/(e.duration_ms/1e3);m[e.source]=(m[e.source]||0)+t});const d=Object.entries(m).sort(([,e],[,t])=>t-e)[0]?.[0]||"jikan";return{averageImportTime:n,successRate:i,errorRate:c,peakImportHour:parseInt(l.toString()),mostEfficientSource:d}}catch(e){return{averageImportTime:0,successRate:0,errorRate:0,peakImportHour:0,mostEfficientSource:"jikan"}}}static async getImportTrends(e=30){try{const t=new Date(Date.now()-24*e*60*60*1e3).toISOString(),{data:r,error:a}=await s.from(this.ANALYTICS_TABLE).select("*").gte("created_at",t).order("created_at",{ascending:!0});if(a||!r)throw new Error(`Failed to fetch trends: ${a?.message}`);const n={};return r.forEach(e=>{const t=new Date(e.created_at).toISOString().split("T")[0];n[t]||(n[t]={imports:0,anime:0}),n[t].imports+=1,n[t].anime+=e.imported_count}),Object.entries(n).map(([e,t])=>({date:e,...t})).sort((e,t)=>e.date.localeCompare(t.date))}catch(t){return[]}}static getStartDate(e){const t=new Date;switch(e){case"day":return new Date(t.getTime()-864e5).toISOString();case"week":return new Date(t.getTime()-6048e5).toISOString();case"month":default:return new Date(t.getTime()-2592e6).toISOString();case"year":return new Date(t.getTime()-31536e6).toISOString()}}static getPeriodString(e){const t=new Date;switch(e){case"daily":return t.toISOString().split("T")[0];case"weekly":return`${new Date(t.getTime()-6048e5).toISOString().split("T")[0]} to ${t.toISOString().split("T")[0]}`;case"monthly":return t.toLocaleDateString("en-US",{year:"numeric",month:"long"});default:return"Custom Period"}}static generateRecommendations(e){const t=[];if(e.successRate<80&&t.push("Consider implementing better error handling and retry logic"),e.averageImportTime>5e3&&t.push("Import times are high - consider optimizing API calls or using batch processing"),e.mostImportedGenres.length>0){const s=e.mostImportedGenres[0];t.push(`Focus on importing more ${s.genre} anime as it's popular`)}return e.errorAnalysis.some(t=>t.count>.1*e.totalImports)&&t.push("High error rate detected - review API rate limits and network stability"),t}static generateInsights(e){const t=[];if(t.push(`Successfully imported ${e.totalAnimeImported} anime in ${e.totalImports} operations`),e.mostImportedGenres.length>0&&t.push(`Most popular genre: ${e.mostImportedGenres[0].genre} (${e.mostImportedGenres[0].count} anime)`),e.sourceBreakdown.length>1){const s=e.sourceBreakdown.sort((e,t)=>t.count-e.count)[0];t.push(`Most used source: ${s.source} (${s.count} anime)`)}const s=e.successfulImports/e.totalImports*100;return t.push(`Import success rate: ${s.toFixed(1)}%`),t}static getEmptyAnalytics(){return{totalImports:0,successfulImports:0,failedImports:0,totalAnimeImported:0,totalAnimeSkipped:0,averageImportTime:0,mostImportedGenres:[],importTrends:[],sourceBreakdown:[],errorAnalysis:[]}}static async saveReport(e){try{const{error:t}=await s.from(this.REPORTS_TABLE).insert({report_id:e.id,report_type:e.reportType,period:e.period,generated_at:e.generatedAt,analytics_data:e.analytics,recommendations:e.recommendations,insights:e.insights})}catch(t){}}}class c{static CACHE_TABLE="image_cache";static CACHE_DURATION=2592e6;static MAX_CACHE_SIZE=1e3;static async initializeImageCache(){try{const{error:e}=await s.rpc("create_image_cache_table")}catch(e){}}static async optimizeAnimePoster(e,t={}){try{const s=await this.getCachedImage(e,t);if(s)return s.optimized_url;const r=await this.generateOptimizedUrl(e,t);return await this.cacheImage(e,r,t),r}catch(s){return e}}static async generateOptimizedUrl(e,t){const s=new URLSearchParams;return t.width&&s.append("w",t.width.toString()),t.height&&s.append("h",t.height.toString()),t.quality&&s.append("q",t.quality.toString()),t.format&&s.append("f",t.format),t.blur&&s.append("blur",t.blur.toString()),`${e}?${s.toString()}`}static async getCachedImage(e,t){try{const r=this.generateCacheKey(e,t),{data:a,error:n}=await s.from(this.CACHE_TABLE).select("*").eq("cache_key",r).gt("expires_at",(new Date).toISOString()).single();return n||!a?null:a}catch(r){return null}}static async cacheImage(e,t,r){try{const a=this.generateCacheKey(e,r),n=new Date(Date.now()+this.CACHE_DURATION),{error:i}=await s.from(this.CACHE_TABLE).insert({cache_key:a,original_url:e,optimized_url:t,width:r.width||0,height:r.height||0,format:r.format||"webp",size_bytes:0,expires_at:n.toISOString(),created_at:(new Date).toISOString()});await this.cleanupCache()}catch(a){}}static generateCacheKey(e,t){const s=JSON.stringify(t);return btoa(`${e}:${s}`)}static async cleanupCache(){try{await s.from(this.CACHE_TABLE).delete().lt("expires_at",(new Date).toISOString());const{data:e}=await s.from(this.CACHE_TABLE).select("id, created_at").order("created_at",{ascending:!1});if(e&&e.length>this.MAX_CACHE_SIZE){const t=e.slice(this.MAX_CACHE_SIZE).map(e=>e.id);await s.from(this.CACHE_TABLE).delete().in("id",t)}}catch(e){}}static async preloadImages(e){const t=e.map(e=>new Promise(t=>{const s=new Image;s.onload=()=>t(),s.onerror=()=>t(),s.src=e}));await Promise.all(t)}static async getImageDimensions(e){try{return new Promise(t=>{const s=new Image;s.onload=()=>{t({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=()=>t(null),s.src=e})}catch(t){return null}}static generateResponsiveUrls(e){return{thumbnail:this.generateOptimizedUrl(e,{width:150,height:200,quality:80}).then(e=>e),small:this.generateOptimizedUrl(e,{width:300,height:400,quality:85}).then(e=>e),medium:this.generateOptimizedUrl(e,{width:600,height:800,quality:90}).then(e=>e),large:this.generateOptimizedUrl(e,{width:1200,height:1600,quality:95}).then(e=>e),original:e}}static async batchOptimizeImages(e){try{const t=e.map(({url:e,options:t})=>this.optimizeAnimePoster(e,t));return await Promise.all(t)}catch(t){return e.map(({url:e})=>e)}}static async getCacheStats(){try{const{data:e,error:t}=await s.from(this.CACHE_TABLE).select("size_bytes, created_at").order("created_at",{ascending:!1});if(t||!e)return{totalImages:0,totalSize:0,oldestEntry:null,newestEntry:null};const r=e.reduce((e,t)=>e+(t.size_bytes||0),0),a=e.length>0?e[e.length-1].created_at:null,n=e.length>0?e[0].created_at:null;return{totalImages:e.length,totalSize:r,oldestEntry:a,newestEntry:n}}catch(e){return{totalImages:0,totalSize:0,oldestEntry:null,newestEntry:null}}}static async clearCache(){try{await s.from(this.CACHE_TABLE).delete().neq("id","00000000-0000-0000-0000-000000000000")}catch(e){}}}const o=()=>{const[s,o]=t.useState(null),[l,m]=t.useState(null),[d,h]=t.useState([]),[p,g]=t.useState(!0),[u,x]=t.useState("month"),[y,j]=t.useState(null);t.useEffect(()=>{f()},[u]);const f=async()=>{try{g(!0);const[e,t,s,r]=await Promise.all([i.getAnalytics(u),i.getPerformanceMetrics(),i.getImportTrends(30),c.getCacheStats()]);o(e),m(t),h(s),j(r)}catch(e){}finally{g(!1)}};return p?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(r,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"ðŸ“Š Import Analytics Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive insights into your anime import system"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:u,onChange:e=>x(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"day",children:"Last 24 Hours"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"}),e.jsx("option",{value:"year",children:"Last Year"})]}),e.jsx(a,{onClick:async()=>{try{await i.generateReport("monthly");alert("Report generated successfully! Check console for details.")}catch(e){alert("Failed to generate report")}},variant:"secondary",children:"ðŸ“„ Generate Report"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 text-xl",children:"ðŸ“¥"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Imports"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s?.totalImports||0})]})]})}),e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 text-xl",children:"âœ…"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Anime Imported"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s?.totalAnimeImported||0})]})]})}),e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-yellow-600 text-xl",children:"âš ï¸"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Success Rate"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l?.successRate?`${l.successRate.toFixed(1)}%`:"0%"})]})]})}),e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 text-xl",children:"âš¡"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Avg Import Time"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l?.averageImportTime?`${(l.averageImportTime/1e3).toFixed(1)}s`:"0s"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ðŸ“ˆ Import Trends"}),e.jsx("div",{className:"space-y-3",children:d.slice(0,7).map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:t.date}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("span",{className:"text-blue-600",children:[t.imports," imports"]}),e.jsxs("span",{className:"text-green-600",children:[t.anime," anime"]})]})]},s))})]}),e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ðŸ”— Source Breakdown"}),e.jsx("div",{className:"space-y-3",children:s?.sourceBreakdown.map((t,r)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium capitalize",children:t.source}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:t.count/(s?.totalAnimeImported||1)*100+"%"}})}),e.jsx("span",{className:"text-sm text-gray-600",children:t.count})]})]},r))})]}),e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ðŸ·ï¸ Most Imported Genres"}),e.jsx("div",{className:"space-y-3",children:s?.mostImportedGenres.slice(0,5).map((t,r)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:t.genre}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:t.count/(s?.mostImportedGenres[0]?.count||1)*100+"%"}})}),e.jsx("span",{className:"text-sm text-gray-600",children:t.count})]})]},r))})]}),e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"âš¡ Performance Metrics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Peak Import Hour"}),e.jsxs("span",{className:"text-sm font-medium",children:[l?.peakImportHour||0,":00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Most Efficient Source"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:l?.mostEfficientSource||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Error Rate"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:l?.errorRate?`${l.errorRate.toFixed(1)}%`:"0%"})]})]})]})]}),e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"ðŸ–¼ï¸ Image Cache Statistics"}),e.jsx(a,{onClick:async()=>{try{await c.clearCache(),alert("Image cache cleared successfully!"),f()}catch(e){alert("Failed to clear cache")}},variant:"secondary",size:"sm",children:"ðŸ—‘ï¸ Clear Cache"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:y?.totalImages||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Cached Images"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:y?.totalSize?`${(y.totalSize/1024/1024).toFixed(1)} MB`:"0 MB"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Cache Size"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:y?.oldestEntry?new Date(y.oldestEntry).toLocaleDateString():"N/A"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Oldest Entry"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:y?.newestEntry?new Date(y.newestEntry).toLocaleDateString():"N/A"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Newest Entry"})]})]})]}),s?.errorAnalysis&&s.errorAnalysis.length>0&&e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"âŒ Error Analysis"}),e.jsx("div",{className:"space-y-3",children:s.errorAnalysis.map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-red-800",children:t.error}),e.jsxs("span",{className:"text-sm text-red-600",children:[t.count," occurrences"]})]},s))})]}),e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ðŸ’¡ Recommendations"}),e.jsxs("div",{className:"space-y-3",children:[l?.successRate&&l.successRate<80&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"âš ï¸ Success rate is below 80%. Consider implementing better error handling and retry logic."})}),l?.averageImportTime&&l.averageImportTime>5e3&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-800",children:"âš¡ Import times are high. Consider optimizing API calls or using batch processing."})}),s?.mostImportedGenres&&s.mostImportedGenres.length>0&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800",children:["ðŸŽ¯ Focus on importing more ",s.mostImportedGenres[0].genre," anime as it's popular among users."]})}),e.jsx("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-purple-800",children:"ðŸ“Š Generate detailed reports regularly to track import performance and identify optimization opportunities."})})]})]})]})};export{o as ImportAnalyticsDashboard};
//# sourceMappingURL=ImportAnalyticsDashboard-D1qIgtPZ.js.map
