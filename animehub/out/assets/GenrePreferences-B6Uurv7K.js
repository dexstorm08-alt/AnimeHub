import{j as e,m as t,A as a}from"./animation-jvELU4qo.js";import{r}from"./react-vendor-DxNDjNG-.js";import{s,S as n}from"./ui-components-C5QItHIj.js";class i{static async getUserPreferences(e){try{const{data:t,error:a}=await s.from("user_preferences").select("*").eq("user_id",e).single();return a?"PGRST116"===a.code?await this.createDefaultPreferences(e):null:t}catch(t){return null}}static async createDefaultPreferences(e){try{const t={user_id:e,favorite_genres:[],preferred_language:"en",auto_play_next:!0,quality_preference:"auto",theme_preference:"light",notification_settings:{email:!0,push:!0,recommendations:!0},privacy_settings:{profile_public:!0,watch_history_public:!1}},{data:a,error:r}=await s.from("user_preferences").insert(t).select().single();return r?null:a}catch(t){return null}}static async updateUserPreferences(e,t){try{const{data:a,error:r}=await s.from("user_preferences").update({...t,updated_at:(new Date).toISOString()}).eq("user_id",e).select().single();return r?null:a}catch(a){return null}}static async updateFavoriteGenres(e,t){try{const{error:a}=await s.from("user_preferences").update({favorite_genres:t,updated_at:(new Date).toISOString()}).eq("user_id",e);return!a}catch(a){return!1}}static async getAvailableGenres(){try{const{data:e,error:t}=await s.from("anime").select("genres").not("genres","is",null);if(t)return[];const a=e.flatMap(e=>e.genres||[]);return Array.from(new Set(a)).sort()}catch(e){return[]}}static async getRecommendedAnime(e,t=10){try{const a=await this.getUserPreferences(e);if(!a||0===a.favorite_genres.length)return[];const{data:r,error:n}=await s.from("anime").select("*").overlaps("genres",a.favorite_genres).limit(t);return n?[]:r||[]}catch(a){return[]}}}function l({userId:s,onSave:l,onCancel:c}){const[o,d]=r.useState([]),[u,m]=r.useState([]),[g,h]=r.useState(!0),[p,x]=r.useState(!1);r.useEffect(()=>{(async()=>{try{h(!0);const[e,t]=await Promise.all([i.getAvailableGenres(),i.getUserPreferences(s)]);d(e),m(t?.favorite_genres||[])}catch(e){}finally{h(!1)}})()},[s]);return g?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(n,{size:"md",text:"Loading genres..."})}):e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-white rounded-xl p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-teal-800 mb-2",children:"Select Your Favorite Genres"}),e.jsx("p",{className:"text-teal-600",children:"Choose the genres you enjoy most. This helps us recommend anime you'll love!"}),e.jsxs("div",{className:"mt-3 flex items-center space-x-4 text-sm text-teal-500",children:[e.jsxs("span",{children:[u.length," selected"]}),e.jsx("button",{onClick:()=>{m(o)},className:"text-blue-600 hover:text-blue-700 underline",children:"Select All"}),e.jsx("button",{onClick:()=>{m([])},className:"text-red-600 hover:text-red-700 underline",children:"Clear All"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 mb-6 max-h-96 overflow-y-auto",children:e.jsx(a,{children:o.map((a,r)=>{const s=u.includes(a);return e.jsx(t.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{delay:.02*r},onClick:()=>(e=>{m(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(a),className:"p-3 rounded-lg border-2 transition-all duration-200 "+(s?"border-teal-500 bg-teal-50 text-teal-800 shadow-md":"border-gray-200 bg-white text-gray-700 hover:border-teal-300 hover:bg-teal-25"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-sm",children:a}),s&&e.jsx(t.i,{initial:{scale:0},animate:{scale:1},className:"ri-check-line text-teal-600 text-sm ml-2"})]})},a)})})}),u.length>0&&e.jsxs(t.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mb-6 p-4 bg-teal-50 rounded-lg border border-teal-200",children:[e.jsx("h4",{className:"font-semibold text-teal-800 mb-2",children:"Your Selected Genres:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(a=>e.jsx(t.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"px-3 py-1 bg-teal-600 text-white text-sm rounded-full",children:a},a))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:c,disabled:p,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{x(!0);await i.updateFavoriteGenres(s,u)?l(u):alert("Failed to save preferences. Please try again.")}catch(e){alert("Failed to save preferences. Please try again.")}finally{x(!1)}},disabled:p,className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 flex items-center",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-save-line mr-2"}),"Save Preferences"]})})]})]})}const c=Object.freeze(Object.defineProperty({__proto__:null,default:l},Symbol.toStringTag,{value:"Module"}));export{l as G,i as U,c as a};
//# sourceMappingURL=GenrePreferences-B6Uurv7K.js.map
